<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password Request - Customer Support System</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body class="auth-page">
    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <h1>Reset Password</h1>
                <p>Enter your email to receive a password reset link</p>
            </div>
            
            <div id="alert-container"></div>
            
            <div class="auth-form">
                <form id="resetRequestForm" method="POST">
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" required autocomplete="email">
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn primary-btn">Request Reset Link</button>
                        <a href="/auth/login" class="btn secondary-btn">Back to Login</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const resetRequestForm = document.getElementById('resetRequestForm');
            const email = document.getElementById('email');
            const alertContainer = document.getElementById('alert-container');
            
            // Handle form submission
            resetRequestForm.addEventListener('submit', async function(event) {
                event.preventDefault();
                
                // Clear previous alerts
                alertContainer.innerHTML = '';
                
                try {
                    const response = await fetch(`/api/auth/password-reset-request?email=${encodeURIComponent(email.value)}`, {
                        method: 'POST'
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        // Show success message
                        const alert = document.createElement('div');
                        alert.className = 'alert alert-success';
                        alert.textContent = 'Password reset email sent. Please check your inbox and follow the instructions.';
                        alertContainer.appendChild(alert);
                        
                        // Disable form
                        email.disabled = true;
                        resetRequestForm.querySelector('button[type="submit"]').disabled = true;
                    } else {
                        // Show error message
                        const alert = document.createElement('div');
                        alert.className = 'alert alert-danger';
                        alert.textContent = data.error || 'Failed to send password reset email. Please try again.';
                        alertContainer.appendChild(alert);
                    }
                } catch (error) {
                    console.error('Password reset request error:', error);
                    const alert = document.createElement('div');
                    alert.className = 'alert alert-danger';
                    alert.textContent = 'An error occurred. Please try again later.';
                    alertContainer.appendChild(alert);
                }
            });
        });
    </script>
</body>
</html>